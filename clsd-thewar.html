<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <base href="https://cdn.jsdelivr.net/gh/greeniYT/y@main/stick-duel-the-war/files.twoplayergames.org/files/games/o1/Stick_Duel_The_War/" target="_blank">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Stick Duel The War</title>
    <link rel="shortcut icon" href="TemplateData/img/favicon.ico">
    <link rel="stylesheet" href="TemplateData/css/style.css">
</head>
<body>
  
	<div class="keepRatio">
		<div id="gameContainer" class="unity-desktop webgl-content">
			<canvas id="gameCanvas"></canvas>
			<div id="loadingBlock">
				<img class="logo" src="TemplateData/img/Logo.png"></img>
			
				<div id="progressBar">
					<div class="centered">
						<div id="emptyBar"></div>
						<div id="fullBar"></div>
					</div>
				</div>
				
				<div id="warningBrowserBlock" style="display:none;">
					<div class="warningBrowserText">
						Your browser may not be compatible with this website. For an optimal experience, we suggest you to download one of this popular web browsers.
					</div>
					<div class="browserIcons">
						<a href="https://www.mozilla.org/firefox" target="_blank"><img src="TemplateData/img/browser-firefox.png" alt="Firefox browser"></a>
						<a href="https://www.google.com/chrome" target="_blank"><img src="TemplateData/img/browser-chrome.png" alt="Chrome browser"></a>
						<a href="https://www.apple.com/safari/" target="_blank"><img src="TemplateData/img/browser-safari.png" alt="Safari browser"></a>
					</div>
				</div>
				<div id="warningMobileBlock" style="display:none;">
					<div class="warningBrowserText">
						Please note that Unity WebGL is not currently supported on mobiles.
					</div>
				</div>
			</div>
		
			<div id="errorBrowserBlock" style="display:none;">
				<img class="logo" src="TemplateData/img/Logo.png"></img>
				<span class="subtitle"> CATCHPHRASE <br>
				Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
				</span>
				
				<div id="errorContent" style="display:none;">
					<div class="errorBrowserText">
						Your browser does not support WebGL. <br> You can download one of this popular web browsers.
					</div>
					<div class="browserIcons">
						<a href="https://www.mozilla.org/firefox" target="_blank"><img src="TemplateData/img/browser-firefox.png" alt="Firefox browser"></a>
						<a href="https://www.google.com/chrome" target="_blank"><img src="TemplateData/img/browser-chrome.png" alt="Chrome browser"></a>
						<a href="https://www.apple.com/safari/" target="_blank"><img src="TemplateData/img/browser-safari.png" alt="Safari browser"></a>
					</div>
				</div>
			</div>
			
		</div>
    </div>
	
	<script>
		function CheckCompatibility()
		{
			if (!hasWebGL()){
				document.getElementById("errorBrowserBlock").style.display = "inherit";
			}
			else if ( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) )
			{
				document.getElementById("warningMobileBlock").style.display = "inherit";
			}
			else if (!isFirefox&&!isSafari&&!isChrome) {
				document.getElementById("warningBrowserBlock").style.display = "inherit";
			}
		}
		
		function hasWebGL() {
			var supported;
			try {
				var canvas = document.createElement('canvas');
				supported = !! window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
			} catch(e) { supported = false; }

			try {
				eval('let foo = 123;');
			} catch (e) { supported = false; }
			canvas = undefined;
			return supported;
		}

		var isFirefox = typeof InstallTrigger !== 'undefined';
		var isSafari = /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === "[object SafariRemoteNotification]"; })(!window['safari'] || (typeof safari !== 'undefined' && safari.pushNotification));
		
		var isChromium = window.chrome;
		var winNav = window.navigator;
		var vendorName = winNav.vendor;
		var isOpera = typeof window.opr !== "undefined";
		var isIEedge = winNav.userAgent.indexOf("Edge") > -1;
		var isIOSChrome = winNav.userAgent.match("CriOS");
		var isChrome =  isIOSChrome || (isChromium !== null && typeof isChromium !== "undefined" && vendorName === "Google Inc." && isOpera === false && isIEedge === false);
		
		var buildUrl = "https://cdn.jsdelivr.net/gh/greeniYT/y@main/stick-duel-the-war/files.twoplayergames.org/files/games/o1/Stick_Duel_The_War/Build";
		var loaderUrl = buildUrl + "/Stick Duel - The War V1.0.3.loader.js";

		var container = document.querySelector("#gameContainer");
		var canvas = document.querySelector("#gameCanvas");
		var loadingBar = document.querySelector("#loadingBlock");
		var progressBarFull = document.querySelector("#fullBar");
		var progressBarEmpty = document.querySelector("#emptyBar");

		if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
			container.className = "unity-mobile";
		}
		CheckCompatibility();

		// Load and merge split files
		async function mergeFiles(parts) {
			const buffers = await Promise.all(
				parts.map(part => fetch(part).then(r => r.arrayBuffer()))
			);
			const totalSize = buffers.reduce((sum, buf) => sum + buf.byteLength, 0);
			const combined = new Uint8Array(totalSize);
			let offset = 0;
			for (const buf of buffers) {
				combined.set(new Uint8Array(buf), offset);
				offset += buf.byteLength;
			}
			return combined.buffer;
		}

		async function initializeGame() {
			try {
				console.log("loading ze parts");
				
				// merge wasm
				const wasmParts = [
					buildUrl + "/Stick Duel - The War V1.0.3.wasm.part1",
					buildUrl + "/Stick Duel - The War V1.0.3.wasm.part2"
				];
				const wasmBuffer = await mergeFiles(wasmParts);
				const wasmBlob = new Blob([wasmBuffer], { type: 'application/wasm' });
				const wasmUrl = URL.createObjectURL(wasmBlob);
				console.log("WASM merged:", wasmBuffer.byteLength, "bytes");
				
				// merge data
				const dataParts = [
					buildUrl + "/Stick Duel - The War V1.0.3.data.part1",
					buildUrl + "/Stick Duel - The War V1.0.3.data.part2",
					buildUrl + "/Stick Duel - The War V1.0.3.data.part3"
				];
				const dataBuffer = await mergeFiles(dataParts);
				const dataBlob = new Blob([dataBuffer], { type: 'application/octet-stream' });
				const dataUrl = URL.createObjectURL(dataBlob);
				console.log("DATA merged:", dataBuffer.byteLength, "bytes");
				
				var config = {
					dataUrl: dataUrl,
					frameworkUrl: buildUrl + "/Stick Duel - The War V1.0.3.framework.js",
					codeUrl: wasmUrl,
					streamingAssetsUrl: "StreamingAssets",
					companyName: "Hihoy",
					productName: "Stick Duel The War",
					productVersion: "1.0.3",
				};
				
				if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
					config.devicePixelRatio = 1;
				}
				
				const script = document.createElement("script");
				script.src = loaderUrl;
				script.onload = () => {
					console.log("Loader script loaded");
					createUnityInstance(canvas, config, (progress) => {
						progressBarFull.style.width = 100 * progress + "%";	 	
						progressBarEmpty.style.width = (100 * (1 - progress)) + "%";
					}).then((unityInstance) => {
						console.log("âœ“ Game loaded!");
						loadingBar.style.display = "none";
					}).catch((message) => {
						console.error("Unity error:", message);
						alert("Game load failed: " + message);
					});
				};
				script.onerror = () => {
					console.error("Failed to load loader script");
					alert("Failed to load game loader script");
				};
				document.body.appendChild(script);
				
			} catch (error) {
				console.error("Initialization failed:", error);
				alert("Failed to initialize game: " + error.message);
			}
		}
		
		// Start initialization
		initializeGame();
		
    </script>
	
  </body>
</html>