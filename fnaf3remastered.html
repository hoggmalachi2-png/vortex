<!-- shxyder -->
<!-- ultimate game stash file -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FNAF 3 Remastered</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: black;
            background-image: url("https://cdn.jsdelivr.net/gh/shayderrr/idk@87ff56487f7a13506c0596be9bc341c81f48e991/fnaf3remastered/rdloading.webp");
            background-size: cover;
            background-position: center;
        }
        #canvas {
            display: block;
            width: 100vw !important;
            height: 100vh !important;
            position: fixed;
            top: 0;
            left: 0;
            outline: none;
        }
        #progress-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 19px;
            background-color: #d19c96;
            z-index: 20;
        }
        #progress-bar {
            width: 0%;
            height: 100%;
            background-color: #a790ba;
            transition: width 0.2s;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/gh/shayderrr/idk@87ff56487f7a13506c0596be9bc341c81f48e991/fnaf3remastered/pako_inflate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/shayderrr/idk@87ff56487f7a13506c0596be9bc341c81f48e991/fnaf3remastered/bridge.js"></script>
</head>
<body>
    <div id="progress-container">
        <div id="progress-bar"></div>
    </div>
    <canvas id="canvas"></canvas>

    <script>
    (function() {
        'use strict';

        const BASE = "https://cdn.jsdelivr.net/gh/shayderrr/idk@87ff56487f7a13506c0596be9bc341c81f48e991/fnaf3remastered/";
        const originalFetch = window.fetch;
        const mergedData = {};
        const pendingRequests = {};

        window.fetch = function(url, ...args) {
            const u = url.toString();
            if (u.includes("index.pck") || u.includes("index.wasm")) {
                const f = u.includes(".pck") ? "index.pck" : "index.wasm";
                if (mergedData[f]) return Promise.resolve(new Response(mergedData[f]));
                return new Promise((resolve) => {
                    if (!pendingRequests[f]) pendingRequests[f] = [];
                    pendingRequests[f].push(resolve);
                });
            }
            return originalFetch(url, ...args);
        };

        async function merge(name, end) {
            const bufs = [];
            for (let i = 1; i <= end; i++) {
                const url = BASE + name + (end > 1 ? `.part${i}` : "");
                const r = await originalFetch(url);
                if (!r.ok) throw new Error();
                bufs.push(await r.arrayBuffer());
            }
            const b = new Blob(bufs, { type: 'application/octet-stream' });
            mergedData[name] = b;
            if (pendingRequests[name]) {
                pendingRequests[name].forEach(res => res(new Response(b)));
                delete pendingRequests[name];
            }
        }

        async function pakoInflateFile(filePath) {
            const r = await fetch(filePath);
            const buf = await r.arrayBuffer();
            return pako.inflate(buf);
        }

        async function init() {
            try {
                const id_for_game = new URLSearchParams(window.location.search).get("id_for_game");
                await bridge.initialize({ platforms: { "game_distribution": { gameId: id_for_game } } });
                
                document.getElementById('progress-bar').style.width = '10%';

                await merge("index.pck", 2);
                await merge("index.wasm", 1);
                
                const s = document.createElement('script');
                s.src = BASE + "index.js";
                s.onload = async () => {
                    const engine = new Engine();
                    const gamedata = "index.pck";
                    const enginedata = "index";

                    try {
                        await pakoInflateFile(gamedata);
                        document.getElementById('progress-bar').style.width = '40%';
                        await pakoInflateFile("index.wasm");
                        document.getElementById('progress-bar').style.width = '50%';
                        
                        await engine.preloadFile(gamedata);
                        document.getElementById('progress-bar').style.width = '80%';
                        
                        await engine.init(enginedata);
                        document.getElementById('progress-bar').style.width = '100%';
                        
                        await engine.start({ args: ['--main-pack', gamedata], focusCanvas: true });
                        document.getElementById('progress-container').style.display = 'none';
                        window.dispatchEvent(new Event('resize'));
                    } catch (err) {
                        console.error(err);
                    }
                };
                document.body.appendChild(s);
            } catch (e) {
                console.error(e);
            }
        }
        init();
    })();
    </script>
</body>
</html>